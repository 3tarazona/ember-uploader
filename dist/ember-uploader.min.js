// ==========================================================================
// Project:   Ember Uploader - v0.1.0
// Homepage:  https://github.com/benefitcloud/ember-uploader
// Copyright: Â©2013 Joshua Borton
// Licensed:  MIT
// ==========================================================================

!function(){var a=Ember.get,b=Ember.set;Ember.Uploader=Ember.Object.extend(Ember.Evented,{file:null,url:null,progress:0,upload:function(){var c=new FormData,d=this;b(this,"isUploading",true);c.append("file",a(this,"file"));return this._ajax(c).then(function(a){d.didUpload(a)})},didUpload:function(c){var d=a(this,"file");b(this,"isUploading",false);if(a(this,"progress")===0){this.didProgress({total:d.size,loaded:d.size})}this.trigger("didUpload",c)},didProgress:function(a){b(this,"progress",a.loaded/a.total*100);this.trigger("progress",a)},_xhr:function(){var a=Ember.$.ajaxSettings.xhr();a.upload.onprogress=this.didProgress.bind(this);return a},_ajax:function(b){var c={url:a(this,"url"),type:"POST",contentType:false,processData:false,xhr:a(this,"xhr"),data:b};return new Ember.RSVP.Promise(function(a,b){c.success=function(b){Ember.run(null,a,b)};c.error=function(a,c,d){Ember.run(null,b,a)};Ember.$.ajax(c)})}})}();