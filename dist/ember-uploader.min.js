// ==========================================================================
// Project:   Ember Uploader - v0.1.0
// Homepage:  https://github.com/benefitcloud/ember-uploader
// Copyright: Â©2013 Joshua Borton
// Licensed:  MIT
// ==========================================================================

var get=Ember.get,set=Ember.set;Ember.Uploader=Ember.Object.extend(Ember.Evented,{file:null,url:null,progress:0,upload:function(){var a=new FormData,b=this;set(this,"isUploading",true);a.append("file",get(this,"file"));return this._ajax(a).then(function(a){b.didUpload(a)})},didUpload:function(a){var b=get(this,"file");set(this,"isUploading",false);if(get(this,"progress")===0){this.didProgress({total:b.size,loaded:b.size})}this.trigger("didUpload",a)},didProgress:function(a){set(this,"progress",a.loaded/a.total*100);this.trigger("progress",a)},_xhr:function(){var a=Ember.$.ajaxSettings.xhr();a.upload.onprogress=this.didProgress.bind(this);return a},_ajax:function(a){var b={url:get(this,"url"),type:"POST",contentType:false,processData:false,xhr:get(this,"xhr"),data:a};return new Ember.RSVP.Promise(function(a,c){b.success=function(b){Ember.run(null,a,b)};b.error=function(a,b,d){Ember.run(null,c,a)};Ember.$.ajax(b)})}});